{% comment %}
  sections/ecomx-product-grid.liquid
  6-card product grid with modal + AJAX cart + bundle rule.
{% endcomment %}

{%- comment -%}
  CSS include – Shopify's stylesheet_tag is valid.
{%- endcomment -%}
{{ 'ecomx-sections.css' | asset_url | stylesheet_tag }}

{%- comment -%}
  JS include – use manual <script> to support defer or async.
  Avoid `script_tag` filter since it doesn’t accept arguments.
{%- endcomment -%}
<script src="{{ 'ecomx-grid.js' | asset_url }}" defer></script>

{%- assign jacket_variant_id = blank -%}
{%- if section.settings.bundled_product != blank -%}
  {%- assign product = all_products[section.settings.bundled_product] -%}
  {%- if product and product.variants.size > 0 -%}
    {%- assign jacket_variant_id = product.variants.first.id -%}
  {%- endif -%}
{%- endif -%}

<section id="ecomx-product-grid" class="ecomx-grid">
  <div class="grid grid--6-col">
    {%- for product in section.settings.products limit: 6 -%}
      <div class="grid__item">
        {%- render 'ecomx-product-card', product: product -%}
      </div>
    {%- endfor -%}
  </div>

  {%- comment -%}
    Example modal placeholder (customize as needed)
  {%- endcomment -%}
  <div id="ecomx-modal" class="ecomx-modal hidden">
    <div class="ecomx-modal__overlay"></div>
    <div class="ecomx-modal__content">
      <button type="button" class="ecomx-modal__close">&times;</button>
      <div class="ecomx-modal__body"></div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "EcomX Product Grid",
  "settings": [
    {
      "type": "product_list",
      "id": "products",
      "label": "Select products"
    },
    {
      "type": "product",
      "id": "bundled_product",
      "label": "Bundled Jacket Product"
    }
  ]
}
{% endschema %}
